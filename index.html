<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raqamli Iqtisodiyot Test</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="timer" id="timer" style="display: none; text-align: center; font-size: 18px; color: red; padding: 10px;">00:30:00</div>
    <div class="container">
        <div class="start-page" id="startPage">
            <h1>Raqamli Iqtisodiyot Test</h1>
            <button onclick="startQuiz()">Testni Boshlang</button>
        </div>

        <div class="quiz-page" id="quizPage" style="display: none;">
            <button class="finish-btn" onclick="finishQuiz()">Tugadi</button>
            <div id="currentQuestion">
                <div id="questionText"></div>
                <div id="options" class="options"></div>
                <button id="prevBtn" onclick="prevQuestion()" style="display: none; padding: 10px 20px; background-color: #2196F3; color: white; border: none; border-radius: 5px; cursor: pointer; margin-right: 10px;">Oldingi</button>
                <button id="nextBtn" onclick="nextQuestion()" style="display: none; padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">Keyingi</button>
            </div>
        </div>

        <div class="result-page" id="resultPage" style="display: none;">
            <h1>Natija</h1>
            <p id="resultText"></p>
            <div id="resultDetails" class="result-details"></div>
            <button onclick="restartQuiz()">Yana Sinov</button>
        </div>
    </div>

    <script src="questions.js"></script>
    <script>
        let selectedQuestions = [];
        let currentQuestionIndex = 0;
        let timeLeft = 30 * 60; // 30 daqiqa (soniyalarda)
        let timerInterval;
        let userAnswers = []; // Foydalanuvchi javoblarini saqlash

        function startQuiz() {
            document.getElementById('startPage').style.display = 'none';
            document.getElementById('quizPage').style.display = 'block';
            document.getElementById('timer').style.display = 'block';

            // 15 ta tasodifiy savol tanlash
            const shuffled = questions.sort(() => 0.5 - Math.random());
            selectedQuestions = shuffled.slice(0, 15);
            userAnswers = Array(15).fill(null); // Javoblar massivini boshlash

            // Birinchi savolni ko‘rsatish
            currentQuestionIndex = 0;
            showQuestion(currentQuestionIndex);

            // Taymerni boshlash
            timeLeft = 30 * 60;
            timerInterval = setInterval(updateTimer, 1000);
        }

        function showQuestion(index) {
            const q = selectedQuestions[index];
            const questionTextDiv = document.getElementById('questionText');
            const optionsDiv = document.getElementById('options');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');

            questionTextDiv.innerHTML = `<h3>${index + 1}. ${q.question}</h3>`;
            optionsDiv.innerHTML = '';
            q.options.forEach((option, i) => {
                optionsDiv.innerHTML += `
                    <input type="radio" name="q${index}" id="q${index}o${i}" value="${i}" onchange="handleAnswerSelection(${index})">
                    <label for="q${index}o${i}">${option}</label>
                `;
            });

            // Oldingi va Keyingi tugmalarni boshqarish
            prevBtn.style.display = index > 0 ? 'inline-block' : 'none';
            nextBtn.style.display = index < selectedQuestions.length - 1 ? 'inline-block' : 'none';

            // Tanlangan javobni qayta yuklash
            if (userAnswers[index] !== null) {
                document.querySelector(`input[name="q${index}"][value="${userAnswers[index]}"]`).checked = true;
            }
        }

        function handleAnswerSelection(index) {
            const selectedOption = document.querySelector(`input[name="q${index}"]:checked`);
            userAnswers[index] = selectedOption ? parseInt(selectedOption.value) : null;

            // Agar bu oxirgi savol bo‘lmasa, keyingi savolga o‘tish
            if (index < selectedQuestions.length - 1) {
                setTimeout(() => nextQuestion(), 300); // 300ms kechikish
            } else {
                // Agar oxirgi savol bo‘lsa, natijaga o‘tish
                setTimeout(() => finishQuiz(), 300);
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < selectedQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion(currentQuestionIndex);
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(currentQuestionIndex);
            }
        }

        function updateTimer() {
            timeLeft--;
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = `00:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            if (timeLeft <= 0) {
                finishQuiz();
            }
        }

        function finishQuiz() {
            clearInterval(timerInterval);
            document.getElementById('quizPage').style.display = 'none';
            document.getElementById('timer').style.display = 'none';
            document.getElementById('resultPage').style.display = 'block';

            // Ballni hisoblash va natijalarni ko‘rsatish
            let score = 0;
            const resultDetails = document.getElementById('resultDetails');
            resultDetails.innerHTML = '';
            selectedQuestions.forEach((q, index) => {
                const userAnswer = userAnswers[index];
                const isCorrect = userAnswer !== null && userAnswer === q.correct;
                if (isCorrect) {
                    score += 2;
                } else if (userAnswer !== null) {
                    score -= 1;
                }
                score = Math.max(0, score);

                const resultItem = document.createElement('p');
                resultItem.innerHTML = `${index + 1}. ${q.question}<br>`;
                const userAnswerText = userAnswer !== null ? q.options[userAnswer] : 'Javob berilmadi';
                resultItem.innerHTML += `Sizning javobingiz: <span class="${isCorrect ? 'correct' : 'incorrect'}">${userAnswerText}</span><br>`;
                resultItem.innerHTML += `To‘g‘ri javob: <span class="correct">${q.options[q.correct]}</span>`;
                resultDetails.appendChild(resultItem);
            });

            document.getElementById('resultText').textContent = `Siz ${score} ball topladingiz (maksimal 30 ball).`;
        }

        function restartQuiz() {
            document.getElementById('resultPage').style.display = 'none';
            document.getElementById('startPage').style.display = 'block';
            document.getElementById('timer').style.display = 'none';
            selectedQuestions = [];
            userAnswers = [];
            currentQuestionIndex = 0;
            clearInterval(timerInterval);
        }
    </script>
</body>
</html>